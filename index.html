<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content CRM ‚Äî Actionable Scripts v7</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0a0a0a; color: #fff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 24px; color: #d4a853; margin-bottom: 5px; }
        .header p { color: #888; font-size: 14px; }
        .stats { display: flex; gap: 15px; justify-content: center; margin-bottom: 30px; flex-wrap: wrap; }
        .stat { background: #1a1a1a; border: 1px solid #333; border-radius: 10px; padding: 12px 20px; text-align: center; min-width: 100px; }
        .stat-num { font-size: 24px; font-weight: bold; color: #d4a853; }
        .stat-label { font-size: 11px; color: #888; }
        .filters { display: flex; gap: 10px; justify-content: center; margin-bottom: 25px; flex-wrap: wrap; }
        .filter-btn { background: #1a1a1a; border: 1px solid #333; color: #aaa; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 13px; transition: all 0.2s; }
        .filter-btn:hover, .filter-btn.active { background: #d4a853; color: #000; border-color: #d4a853; }
        .scripts-grid { display: grid; gap: 15px; max-width: 900px; margin: 0 auto; }
        .card { background: #1a1a1a; border: 1px solid #2a2a2a; border-radius: 12px; overflow: hidden; transition: border-color 0.2s; }
        .card:hover { border-color: #d4a853; }
        .card-header { padding: 16px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .card-title { font-size: 16px; font-weight: 600; flex: 1; }
        .card-meta { display: flex; gap: 8px; align-items: center; }
        .badge { font-size: 11px; padding: 3px 8px; border-radius: 10px; background: #2a2a2a; color: #aaa; }
        .badge.draft { background: #3a2a0a; color: #d4a853; }
        .badge.ready { background: #0a3a0a; color: #4ade80; }
        .badge.filmed { background: #0a2a3a; color: #60a5fa; }
        .badge.posted { background: #2a0a3a; color: #c084fc; }
        .arrow { color: #666; transition: transform 0.2s; font-size: 18px; }
        .card.open .arrow { transform: rotate(180deg); }
        .card-body { display: none; padding: 0 16px 16px; }
        .card.open .card-body { display: block; }
        .section { margin-bottom: 14px; }
        .section-title { font-size: 12px; color: #d4a853; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; }
        .hook { background: #111; border-left: 3px solid #d4a853; padding: 8px 12px; margin-bottom: 5px; border-radius: 0 6px 6px 0; font-size: 14px; color: #ddd; }
        .caption { background: #111; border-left: 3px solid #60a5fa; padding: 8px 12px; margin-bottom: 5px; border-radius: 0 6px 6px 0; font-size: 14px; color: #ddd; font-weight: 600; }
        .script-text { background: #111; padding: 14px; border-radius: 8px; font-size: 14px; line-height: 1.7; color: #ccc; white-space: pre-wrap; }
        .script-text .show { color: #60a5fa; font-style: italic; }
        .based-on { font-size: 12px; color: #888; margin-top: 8px; }
        .notes { font-size: 12px; color: #666; font-style: italic; margin-top: 6px; }
        .status-btns { display: flex; gap: 6px; margin-top: 10px; }
        .status-btn { font-size: 11px; padding: 4px 10px; border-radius: 12px; border: 1px solid #333; background: #1a1a1a; color: #aaa; cursor: pointer; }
        .status-btn:hover { background: #d4a853; color: #000; border-color: #d4a853; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ü¶û Content CRM</h1>
        <p id="subtitle">Loading...</p>
    </div>
    <div class="stats" id="stats"></div>
    <div class="filters" id="filters"></div>
    <div class="scripts-grid" id="scripts"></div>

    <script>
        let data = null;

        async function load() {
            try {
                const r = await fetch('scripts.json?t=' + Date.now());
                data = await r.json();
                document.getElementById('subtitle').textContent = data.stats.type + ' ‚Äî ' + data.updated;
                renderStats();
                renderFilters();
                renderScripts();
            } catch(e) {
                document.getElementById('subtitle').textContent = 'Error: ' + e.message;
            }
        }

        function renderStats() {
            const counts = { draft: 0, ready: 0, filmed: 0, posted: 0 };
            data.scripts.forEach(s => { counts[s.status || 'draft']++; });
            document.getElementById('stats').innerHTML = `
                <div class="stat"><div class="stat-num">${data.scripts.length}</div><div class="stat-label">Total Scripts</div></div>
                <div class="stat"><div class="stat-num">${counts.draft}</div><div class="stat-label">üí° Draft</div></div>
                <div class="stat"><div class="stat-num">${counts.ready}</div><div class="stat-label">üìù Ready</div></div>
                <div class="stat"><div class="stat-num">${counts.filmed}</div><div class="stat-label">üé¨ Filmed</div></div>
                <div class="stat"><div class="stat-num">${counts.posted}</div><div class="stat-label">üì± Posted</div></div>
            `;
        }

        function renderFilters() {
            document.getElementById('filters').innerHTML = `
                <div class="filter-btn active" onclick="filter('all')">All</div>
                <div class="filter-btn" onclick="filter('draft')">üí° Draft</div>
                <div class="filter-btn" onclick="filter('ready')">üìù Ready</div>
                <div class="filter-btn" onclick="filter('filmed')">üé¨ Filmed</div>
                <div class="filter-btn" onclick="filter('posted')">üì± Posted</div>
            `;
        }

        function filter(status) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.card').forEach(c => {
                if (status === 'all' || c.dataset.status === status) {
                    c.style.display = '';
                } else {
                    c.style.display = 'none';
                }
            });
        }

        function formatScript(text) {
            return text.replace(/\[SHOW:([^\]]+)\]/g, '<span class="show">[SHOW:$1]</span>');
        }

        function renderScripts() {
            const el = document.getElementById('scripts');
            el.innerHTML = data.scripts.map((s, i) => `
                <div class="card" data-status="${s.status || 'draft'}" data-index="${i}">
                    <div class="card-header" onclick="this.parentElement.classList.toggle('open')">
                        <div class="card-title">${s.title}</div>
                        <div class="card-meta">
                            <span class="badge ${s.status || 'draft'}">${s.status || 'draft'}</span>
                            <span class="arrow">‚ñº</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="based-on">Based on: ${s.competitor_style || ''}</div>
                        
                        <div class="section">
                            <div class="section-title">Hooks (pick one)</div>
                            ${(s.hooks || []).map(h => `<div class="hook">"${h}"</div>`).join('')}
                        </div>
                        
                        <div class="section">
                            <div class="section-title">Screen Captions (pick one)</div>
                            ${(s.screen_captions || []).map(c => `<div class="caption">${c}</div>`).join('')}
                        </div>
                        
                        <div class="section">
                            <div class="section-title">Full Script</div>
                            <div class="script-text">${formatScript(s.full_script || '')}</div>
                        </div>
                        
                        ${s.notes ? `<div class="notes">üí° ${s.notes}</div>` : ''}
                    </div>
                </div>
            `).join('');
        }

        load();
    </script>
</body>
</html>
